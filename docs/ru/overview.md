# üìñ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

InvoiceFlowBot —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ Telegram –±–æ—Ç, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–π –∏—Ö —á–µ—Ä–µ–∑ —Å–ª–æ–π OCR:

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±–æ—Ç—É PDF –∏–ª–∏ —Ñ–æ—Ç–æ —Å—á–µ—Ç–∞, –∑–∞–≥—Ä—É–∂–∞—è —Ñ–∞–π–ª –ø—Ä—è–º–æ –≤ —á–∞—Ç.
- `handlers/file.py` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–∏–µ, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª.
- `services/invoice_service.py` –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤—ã OCR —á–µ—Ä–µ–∑ `ocr/engine/router.py` –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –¥–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (`domain/invoices.py`).
- –°–ª–æ–π OCR —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤: –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `OcrProvider` –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é `MindeeOcrProvider`. –ú–æ–¥—É–ª—å `ocr.engine.router` –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Å—á–µ—Ç–æ–≤. –í –æ—Å—Ç–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏—è `extract_invoice` –∏–∑ `ocr.engine.router`.
- –ü–æ–ª—É—á–µ–Ω–Ω—ã–π —á–µ—Ä–Ω–æ–≤–∏–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è (`handlers/state.py`), –∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ SQLite (`storage/db.py`).
- –¢–µ–ª–µ–≥—Ä–∞–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (`handlers/commands.py`, `handlers/callbacks.py`, `handlers/utils.py`) –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—è, –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é.

## –î–≤–∏–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PDF –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –±–æ—Ç.
2. `handlers/file.py` –ø–æ–ª—É—á–∞–µ—Ç —Ñ–∞–π–ª –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `services/invoice_service.process_invoice_file()`.
3. –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π –∑–∞–ø—É—Å–∫–∞–µ—Ç `ocr/engine/router.py`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OCR-–ø—Ä–æ–≤–∞–π–¥–µ—Ä (–≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è `MindeeOcrProvider`) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏–∑ Mindee API.
4. `services/invoice_service.py` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç OCR (`ExtractionResult`) –≤ –¥–æ–º–µ–Ω–Ω—É—é —Å—É—â–Ω–æ—Å—Ç—å `Invoice`.
5. –ß–µ—Ä–Ω–æ–≤–∏–∫ `Invoice` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (`handlers/state.py`), –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –µ–≥–æ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã (`handlers/commands.py`) –∏–ª–∏ callback-–∫–Ω–æ–ø–∫–∏ (`handlers/callbacks.py`).
6. –ö–æ–º–∞–Ω–¥–∞ `/save` –∏–ª–∏ callback —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç `services/invoice_service.save_invoice()`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–æ–º–µ–Ω–Ω—É—é —Å—É—â–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ `storage/db.py` –≤ `data.sqlite`.
7. –ö–æ–º–∞–Ω–¥–∞ `/invoices` –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç `services/invoice_service.list_invoices()`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∞–µ—Ç –¥–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏–∑ `storage/db.py` —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –ø–µ—Ä–∏–æ–¥—É –∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫—É.

## –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

- `bot.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ Telegram –±–æ—Ç–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤.
- `config.py` ‚Äî —á—Ç–µ–Ω–∏–µ `.env`, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏, –∫–ª—é—á–∞–º–∏ Mindee –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
- `domain/` ‚Äî –¥–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (Invoice, InvoiceHeader, InvoiceItem –∏ —Ç.–¥.), –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –æ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
- `services/` ‚Äî —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π, –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é—â–∏–π –¥–æ–º–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É, OCR-–ø–∞–π–ø–ª–∞–π–Ω –∏ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.
- `handlers/` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Telegram –±–æ—Ç–∞:
  - `file.py` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏ –Ω–∞—á–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ OCR
  - `commands.py` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ (/show, /edit, /invoices –∏ —Ç.–¥.)
  - `callbacks.py` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è inline-–∫–Ω–æ–ø–æ–∫ (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ —Ç.–¥.)
  - `utils.py` ‚Äî —É—Ç–∏–ª–∏—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä
  - `state.py` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ—Å—Å–∏–π
- `ocr/` ‚Äî —Å–ª–æ–π OCR —Å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–µ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:
  - `providers/` ‚Äî —Å–ª–æ–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:
    - `base.py` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `OcrProvider`, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è OCR-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
    - `mindee_provider.py` ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `MindeeOcrProvider`, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤—ã –≤ Mindee API
  - `engine/router.py` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –¥–ª—è –≤—ã–∑–æ–≤–∞ OCR-—Å–µ—Ä–≤–∏—Å–æ–≤; –æ—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç `router.extract_invoice`
  - `mindee_client.py` ‚Äî –ø—Ä—è–º–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Mindee API (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `MindeeOcrProvider`)
  - –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `storage/db.py` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω–≤–æ–π—Å–æ–≤, –≤—ã–±–æ—Ä–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
- `tests/` ‚Äî pytest –ø–æ–∫—Ä—ã—Ç–∏–µ –¥–ª—è –¥–æ–º–µ–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π, –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–æ–≤ Mindee, —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∏ —Ä–∞–±–æ—Ç—ã —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º.
