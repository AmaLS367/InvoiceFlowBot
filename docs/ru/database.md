# База данных

InvoiceFlowBot использует SQLite — легковесную файловую базу, не требующую отдельного сервера. По умолчанию данные сохраняются в `data.sqlite` в корне проекта (или внутри контейнера, если путь не смонтирован). Путь можно изменить переменной `INVOICE_DB_PATH`.

## Структура

Функция `storage/db.py:init_db()` выполняется при старте и гарантирует наличие таблиц:

- `invoices` — шапка инвойса: пользователь, поставщик, клиент, номер документа, даты, сумма, текстовый оригинал и путь к исходному файлу.
- `invoice_items` — позиции счета: индекс строки, код, название, количество, цена, сумма.
- `comments` — список комментариев пользователей, связанных с записанными счетами.

Включен режим `WAL` для устойчивости к параллельным операциям Telegram пользователей.

## Рекомендации

- Не добавляйте `data.sqlite` в репозиторий, храните его в `.gitignore`.
- Регулярно делайте резервную копию файла, особенно перед обновлением. Достаточно скопировать файл на диск:
```powershell
Copy-Item .\data.sqlite .\backup\data-$(Get-Date -Format yyyyMMddHHmmss).sqlite
```
- При работе в Docker убедитесь, что volume `./data.sqlite:/app/data.sqlite` корректно монтирует файл, иначе данные будут внутри контейнера и могут потеряться.

## Восстановление

Чтобы перенести базу на другой сервер, остановите бот, скопируйте файл `data.sqlite` и замените им файл на новой машине. После запуска `init_db()` произведет миграции, если потребуется.

