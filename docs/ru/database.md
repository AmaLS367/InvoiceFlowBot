<img src="https://capsule-render.vercel.app/api?type=waving&color=gradient&customColorList=6,11,20&height=120&section=header&text=–ë–∞–∑–∞+–¥–∞–Ω–Ω—ã—Ö&fontSize=40&animation=fadeIn"/>

<div align="center">

[![SQLite](https://img.shields.io/badge/Database-SQLite-blue?style=for-the-badge&logo=sqlite&logoColor=white)](https://www.sqlite.org/)
[![Alembic](https://img.shields.io/badge/Migrations-Alembic-green?style=for-the-badge)](https://alembic.sqlalchemy.org/)
[![WAL](https://img.shields.io/badge/Mode-WAL-orange?style=for-the-badge)](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

</div>

## üìã –û –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

InvoiceFlowBot –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQLite ‚Äî –ª–µ–≥–∫–æ–≤–µ—Å–Ω—É—é —Ñ–∞–π–ª–æ–≤—É—é –±–∞–∑—É, –Ω–µ —Ç—Ä–µ–±—É—é—â—É—é –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `data.sqlite` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–∏–ª–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –µ—Å–ª–∏ –ø—É—Ç—å –Ω–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω). –ü—É—Ç—å –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `INVOICE_DB_PATH`.

> [!NOTE]
> SQLite –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –ë–î - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ!

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞

–§—É–Ω–∫—Ü–∏—è `backend.storage.db:init_db()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü:

- `invoices` ‚Äî —à–∞–ø–∫–∞ –∏–Ω–≤–æ–π—Å–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø–æ—Å—Ç–∞–≤—â–∏–∫, –∫–ª–∏–µ–Ω—Ç, –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞, –¥–∞—Ç—ã, —Å—É–º–º–∞, —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ä–∏–≥–∏–Ω–∞–ª –∏ –ø—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É.
- `invoice_items` ‚Äî –ø–æ–∑–∏—Ü–∏–∏ —Å—á–µ—Ç–∞: –∏–Ω–¥–µ–∫—Å —Å—Ç—Ä–æ–∫–∏, –∫–æ–¥, –Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ü–µ–Ω–∞, —Å—É–º–º–∞.
- `comments` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–º–∏ —Å—á–µ—Ç–∞–º–∏.

–í–∫–ª—é—á–µ–Ω —Ä–µ–∂–∏–º `WAL` –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∫ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º –æ–ø–µ—Ä–∞—Ü–∏—è–º Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏

–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –ë–î –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ [Alembic](https://alembic.sqlalchemy.org/). –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç —Ç–∞–±–ª–∏—Ü—ã (–≤ —Ç–æ–º —á–∏—Å–ª–µ `invoice_drafts` –¥–ª—è —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ –∏–Ω–≤–æ–π—Å–æ–≤).

### –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

- **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫** ‚Äî –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º —Å—Ç–∞—Ä—Ç–æ–º –±–æ—Ç–∞, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–ª–∏—Å—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã.
- **–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è** ‚Äî –µ—Å–ª–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏.
- **–ü–æ—Å–ª–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è** ‚Äî —á—Ç–æ–±—ã –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–µ.

–ë–æ—Ç —Ç–∞–∫–∂–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —á–µ—Ä–µ–∑ `backend.storage.db.init_db()`, –Ω–æ –æ–¥–∏–Ω —Ä–∞–∑ –∏—Ö —Å—Ç–æ–∏—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Ç–æ—Ç –∂–µ —Ñ–∞–π–ª –ë–î (—Å–º. –Ω–∏–∂–µ).

### –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

**–í—Å–µ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞** (–∫–∞—Ç–∞–ª–æ–≥ `InvoiceFlowBot`), —á—Ç–æ–±—ã –ø–æ–¥—Ö–≤–∞—Ç–∏–ª–∏—Å—å –∫–æ–Ω—Ñ–∏–≥ –∏ `.env` –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å –∫ —Ç–æ–π –∂–µ –±–∞–∑–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–æ—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `backend/data.sqlite`).

```powershell
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ (Windows)
python -m alembic -c backend/alembic.ini upgrade head
```

–ò–ª–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç:

```powershell
python scripts/python/migrate.py
```

Linux/macOS:

```bash
./scripts/linux/migrate.sh
```

–î—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã (–∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞):

```powershell
# –û—Ç–∫–∞—Ç–∏—Ç—å –æ–¥–Ω—É –º–∏–≥—Ä–∞—Ü–∏—é
python scripts/python/migrate.py downgrade -1

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é (—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º)
python -m alembic -c backend/alembic.ini revision -m "–æ–ø–∏—Å–∞–Ω–∏–µ_–∏–∑–º–µ–Ω–µ–Ω–∏—è"
```

> [!TIP]
> –ï—Å–ª–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞ `no such table: invoice_drafts` –∏–ª–∏ `unable to open database file`, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞, –∫–∞–∫ –≤—ã—à–µ. –ü—É—Ç—å –∫ –±–∞–∑–µ –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`INVOICE_DB_PATH` / `backend/data.sqlite`), –∞ –Ω–µ –∏–∑ `alembic.ini`.

## ‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

> [!WARNING]
> –†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ `data.sqlite`!

- ‚ùå –ù–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ `data.sqlite` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–µ—Å—Ç—å –≤ `.gitignore`)
- üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:
```powershell
Copy-Item .\data.sqlite .\backup\data-$(Get-Date -Format yyyyMMddHHmmss).sqlite
```
- üê≥ –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ –≤ Docker –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å volume mapping

## –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

–ß—Ç–æ–±—ã –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –±–∞–∑—É –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä, –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `data.sqlite` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –∏–º —Ñ–∞–π–ª –Ω–∞ –Ω–æ–≤–æ–π –º–∞—à–∏–Ω–µ. –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `init_db()` –ø—Ä–æ–∏–∑–≤–µ–¥–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è.
