# Типовые проблемы

## sqlite3.OperationalError: unable to open database file
- **Проблема:** при старте контейнера база не открывается.
- **Причина:** вместо файла `data.sqlite` на хосте создана директория, поэтому volume монтируется некорректно.
- **Решение:** остановите контейнер, удалите директорию, создайте пустой файл PowerShell командой `New-Item .\data.sqlite -ItemType File | Out-Null`, затем запустите `docker-compose up --build -d`.

## Бот не отвечает в Telegram
- **Проблема:** команды остаются без ответа, либо Telegram сообщает об ошибке токена.
- **Причина:** неверный `BOT_TOKEN`, проблемы с подключением к сети или блокировка Telegram.
- **Решение:** перепроверьте токен в `.env`, перезапустите бот. Убедитесь, что сервер имеет доступ к `api.telegram.org`. Загляните в `logs/errors.log` для дополнительной информации.

## Ошибки Mindee API
- **Проблема:** во время обработки файлов появляются сообщения об ошибке Mindee.
- **Причина:** неправильный `MINDEE_API_KEY`, некорректный `MINDEE_MODEL_ID` или временные проблемы сети.
- **Решение:** обновите ключ и идентификатор модели в `.env`, убедитесь, что учетная запись Mindee активна. Проверьте сетевые настройки, при необходимости повторите отправку позже.

## Ошибки обработки файлов
- **Проблема:** бот сообщает "Не удалось обработать файл" или похожие сообщения об ошибке.
- **Причина:** поврежденный PDF, неподдерживаемый формат изображения или ошибка конвертации файла (например, HEIC/HEIF в JPEG).
- **Поведение:** бот отправляет пользователю понятное сообщение об ошибке в Telegram и записывает детальную информацию (включая путь к файлу и трассировку исключения) в `logs/errors.log` для отладки.
- **Решение:** убедитесь, что файл является валидным PDF или поддерживаемым форматом изображения (JPEG, PNG). Для файлов HEIC/HEIF бот пытается выполнить автоматическую конвертацию; если она не удалась, попробуйте конвертировать файл вручную перед загрузкой.

## Ошибки сервиса распознавания
- **Проблема:** бот отвечает "Сервис распознавания сейчас недоступен".
- **Причина:** таймаут сети, ответ Mindee API 4xx/5xx или недоступность сервиса.
- **Поведение:** бот отправляет пользователю понятное сообщение и записывает полные детали ошибки (включая путь запроса, статус ответа и исключение) в `logs/errors.log` для расследования.
- **Решение:** проверьте подключение к сети, убедитесь в работоспособности Mindee API и повторите попытку после небольшой задержки. Просмотрите `logs/errors.log` для получения конкретных кодов ошибок или сообщений.

## Docker контейнер мгновенно завершается
- **Проблема:** `docker ps` показывает, что сервис остановился вскоре после запуска.
- **Причина:** отсутствуют обязательные переменные окружения или нет доступа к логам/базе.
- **Решение:** откройте `docker logs <container>`, проверьте наличие `BOT_TOKEN`, `MINDEE_API_KEY`, `MINDEE_MODEL_ID` и права записи к `logs/` и `data.sqlite`.

## Логи не пишутся
- **Проблема:** директория `logs/` пустая, даже при активном использовании.
- **Причина:** задан `LOG_DIR`, который не существует или недоступен. Либо `LOG_LEVEL` установлен слишком высоко.
- **Решение:** убедитесь, что каталог существует и доступен на запись, либо удалите переменную `LOG_DIR` и позвольте приложению создать `logs/`. Для диагностики установите `LOG_LEVEL=INFO`.

