# Использование бота

Стандартный сценарий:

1. Пользователь запускает чат с ботом и вводит `/start`, чтобы получить клавиатуру и подсказки.
2. Загружает PDF или изображение счета. Бот подтверждает получение и отправляет файл на OCR.
3. Mindee распознает документ, после чего бот формирует черновик и показывает его через `/show`.
4. Пользователь редактирует поля счета или отдельные позиции командами и кнопками.
5. После проверки итог сохраняется командой `/save`, запись попадает в SQLite.
6. Для аналитики можно вызвать `/invoices <from> <to> [supplier=...]` и получить список исторических данных.

## Команды

- `/start` — инициализация диалога, выводит клавиатуру действий.
- `/help` — краткая справка по возможностям бота.
- `/show` — показать текущий черновик после OCR или правок.
- `/save` — сохранить черновик в базу и очистить состояние.
- `/edit supplier=... client=... date=YYYY-MM-DD doc=... total=123.45` — массовое редактирование шапки счета.
- `/edititem <index> name=... qty=... price=... total=...` — скорректировать отдельную позицию по индексу.
- `/comment <text>` — добавить текстовый комментарий к текущему счету.
- `/invoices YYYY-MM-DD YYYY-MM-DD [supplier=text]` — получить сохраненные счета за период с опциональной фильтрацией по поставщику.

## Интерактивные кнопки

`handlers/utils.py` формирует inline клавиатуру. Типичные действия:
- Загрузить новый счет.
- Открыть черновик и отредактировать отдельные поля.
- Добавить комментарий или позицию.
- Сохранить черновик в базу.
- Запросить счета по периоду без ввода команды.

Кнопки облегчают работу пользователям, которым неудобно вводить параметры вручную, но все действия дублируются командами.

## Работа с черновиком

Бот хранит промежуточные значения в состоянии пользователя. Пока данные не сохранены, можно отправлять новые файлы, откатывать изменения или дополнять комментариями. После `/save` черновик очищается, а команды `/show` и `/edit` начнут работать с новым документом.
